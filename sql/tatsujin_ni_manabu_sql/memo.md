## 用語集

## SELECT文の記述順序

## SELECT文の実行順序

## 相関サブクエリ
- サブクエリ内でWHERE句などを使って、テーブルの一部のレコードに限定した比較を行う
- 小分けにしたグループ内での比較をするときに利用する
- GROUP BY句の集合をカットする性質と同じ


## HAVING句
- とある集合（部分集合）に対しての条件（性質）を指定する
- レコード単位では見ず、集合としてとらえる
- GROUP BYが必須と思われがちだが、なくても使える。その場合の対象も集合とみなされる


## 特性関数
- CASE式を使って、各要素が特定の条件を満たす集合に含まれるかどうかを調べるもの

```
-- サンプル
HAVING COUNT(*) = SUM(CASE WHEN xxx IS NOT NULL THEN 1 ELSE 0 END)
```

## SQLで集合演算
- 和: UNION（ベン図で言う論理和OR）
- 差: EXCEPT
- 積: CROSS JOIN
- 商: 無し
- 交差: INTERSECT （ベン図で言う論理積AND）
- 除算の方法
  - NOT EXISTS句を使う
  - HAVING句を使って1対1対応を利用する
  - 割り算を引き算で表現する



## 述語論理
- SQLでは一階述語論理のこと
- 述語とは戻り値が真理値になる関数
- 述語論理で考えるとテーブルは行の集合ではなく、命題の集合
- 量化：


## EXISTS
- EXISTS句は行の集合を入力にする
- =やBETWEENなど一行を入力とする述語は「一階の述語」
- EXISTSのように集合を入力とする述語は「二階の述語」になる。高階関数ともいえる
  - 一階の述語が扱うのは0階（行）、二階の述語が扱うのは1階（テーブル・行集合）

## 全称量化と存在量化
- すべてのxが条件Pを満たすが全称量化
- 条件Pを満たすxが少なくとも１つ存在するが存在量化
- SQLでは全称量化がないので存在量化子をうまくつかって表す
  - すべてのxが条件Pを満たす = 条件Pを満たさないxが存在しない
  - 条件Pを満たすxが存在する = すべてのxが条件Pを満たさないわけではない
- データの存在チェックをするときは、仮のデータすべての集合から、実際のデータをNOT EXISTSを使って限定する
- SQLで全称文を記述したいときは、存在文の否定に同値変形して、NOT EXISTS句を使う
- 全称文は集合的に書き換えも可能。HAVING ⇔EXISTS(NOT EXISTS)を考える

## 集合論


## 自己結合
- 非等値結合:=以外の比較演算子を条件にして使う結合。特に自分自身に対して行う場合、自己非等値結合という


## 同心円的な再帰集合
- 同心円的な再帰的集合を作り、それらの要素数を数える
- S3 ⊃S2 ⊃S1 ⊃S0 という包含関係


```
-- イメージ
S0 = 空集合
S1 = {100}
S2 = {100, 80}
S3 = {100,80,50}
```

## SQLは3値論理
- true, false, unknown
- NOT INとNOT EXISTSはNULLがあると結果が変わるので注意


## 全単射（一対一対応）
